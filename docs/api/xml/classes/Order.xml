<?xml version="1.0" encoding="UTF-8"?>
<class xmlns="http://xml.phpdox.net/src#" full="Order" namespace="" name="Order" abstract="false" final="false" start="33" end="2823">
  <file path="./../../../code/model" file="Order.php" realpath="/var/www/3.1.silverstripe-ecommerce.com/ecommerce/code/model/Order.php" size="86119" time="2015-02-27T15:21:08+13:00" unixtime="1425003668" sha1="139d51f5b86bbb57651303baa89e09b886700772"/>
  <docblock>
    <description/>
    <description compact="The order class is a databound object for handling Orders within SilverStripe.">Note that it works closely with the ShoppingCart class, which accompanies the Order
until it has been paid for / confirmed by the user.


CONTENTS:
----------------------------------------------
1. CMS STUFF
2. MAIN TRANSITION FUNCTIONS:
3. STATUS RELATED FUNCTIONS / SHORTCUTS
4. LINKING ORDER WITH MEMBER AND ADDRESS
5. CUSTOMER COMMUNICATION
6. ITEM MANAGEMENT
7. CRUD METHODS (e.g. canView, canEdit, canDelete, etc...)
8. GET METHODS (e.g. Total, SubTotal, Title, etc...)
9. TEMPLATE RELATED STUFF
10. STANDARD SS METHODS (requireDefaultRecords, onBeforeDelete, etc...)
11. DEBUG</description>
    <authors value=": Nicolaas [at] Sunny Side Up .co.nz"/>
    <package value=": ecommerce"/>
    <sub value="-package: model"/>
    <inspiration value=": Silverstripe Ltd, Jeremy">NOTE: This is the SQL for selecting orders in sequence of</inspiration>
  </docblock>
  <extends full="DataObject" namespace="" name="DataObject"/>
  <implements full="EditableEcommerceObject" namespace="" name="EditableEcommerceObject"/>
  <member name="api_access" type="array" visibility="private" line="39">
    <docblock>
      <description compact="API Control"/>
      <var type="object">
        <type full="Array" namespace="" name="Array"/>
      </var>
    </docblock>
  </member>
  <member name="db" type="array" visibility="private" line="76">
    <docblock>
      <description compact="standard SS variable"/>
      <var type="object">
        <type full="Array" namespace="" name="Array"/>
      </var>
    </docblock>
  </member>
  <member name="has_one" type="array" visibility="private" line="85"/>
  <member name="has_many" type="array" visibility="private" line="98">
    <docblock>
      <description compact="standard SS variable"/>
      <var type="object">
        <type full="Array" namespace="" name="Array"/>
      </var>
    </docblock>
  </member>
  <member name="indexes" type="array" visibility="private" line="109">
    <docblock>
      <description compact="standard SS variable"/>
      <var type="object">
        <type full="Array" namespace="" name="Array"/>
      </var>
    </docblock>
  </member>
  <member name="default_sort" type="string" default="&quot;\&quot;LastEdited\&quot; DESC&quot;" visibility="private" line="117">
    <docblock>
      <description compact="standard SS variable"/>
      <var type="object">
        <type full="String" namespace="" name="String"/>
      </var>
    </docblock>
  </member>
  <member name="casting" type="array" visibility="private" line="123">
    <docblock>
      <description compact="standard SS variable"/>
      <var type="object">
        <type full="Array" namespace="" name="Array"/>
      </var>
    </docblock>
  </member>
  <member name="create_table_options" type="array" visibility="private" line="152">
    <docblock>
      <description compact="standard SS variable"/>
      <var type="object">
        <type full="Array" namespace="" name="Array"/>
      </var>
    </docblock>
  </member>
  <member name="singular_name" type="string" default="&quot;Order&quot;" visibility="private" line="160">
    <docblock>
      <description compact="standard SS variable"/>
      <var type="object">
        <type full="String" namespace="" name="String"/>
      </var>
    </docblock>
  </member>
  <method name="i18n_singular_name" start="161" end="161" abstract="false" final="false" static="false" visibility="public"/>
  <member name="plural_name" type="string" default="&quot;Orders&quot;" visibility="private" line="167">
    <docblock>
      <description compact="standard SS variable"/>
      <var type="object">
        <type full="String" namespace="" name="String"/>
      </var>
    </docblock>
  </member>
  <method name="i18n_plural_name" start="168" end="168" abstract="false" final="false" static="false" visibility="public"/>
  <member name="description" type="string" default="&quot;A collection of items that together make up the 'Order'.  An order can be placed.&quot;" visibility="private" line="174">
    <docblock>
      <description compact="Standard SS variable."/>
      <var type="object">
        <type full="String" namespace="" name="String"/>
      </var>
    </docblock>
  </member>
  <member name="needs_recalculating" type="{unknown}" default="false" visibility="private" line="180">
    <docblock>
      <description compact="Tells us if an order needs to be recalculated"/>
      <var type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </var>
    </docblock>
  </member>
  <method name="set_needs_recalculating" start="181" end="183" abstract="false" final="false" static="true" visibility="public">
    <parameter name="b" byreference="false" type="{unknown}" default="true"/>
  </method>
  <method name="get_needs_recalculating" start="184" end="184" abstract="false" final="false" static="true" visibility="public"/>
  <member name="totalItems" type="{unknown}" default="null" visibility="protected" line="193">
    <docblock>
      <description compact="Total Items : total items in cart We start with -1 to easily identify if it has been run before."/>
      <var type="integer"/>
    </docblock>
  </member>
  <member name="totalItemsTimesQuantity" type="{unknown}" default="null" visibility="protected" line="200">
    <docblock>
      <description compact="Total Items : total items in cart We start with -1 to easily identify if it has been run before."/>
      <var type="object">
        <type full="Double" namespace="" name="Double"/>
      </var>
    </docblock>
  </member>
  <method name="getModifierForms" start="215" end="236" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Returns a set of modifier forms for use in the checkout order form, Controller is optional, because the orderForm has its own default controller.">This method only returns the Forms that should be included outside
the editable table... Forms within it can be called
from through the modifier itself.</description>
      <param type="object" variable="$optionalController">
        <type full="Controller" namespace="" name="Controller"/>
      </param>
      <param type="object" variable="$optionalValidator">
        <type full="Validator" namespace="" name="Validator"/>
      </param>
      <return description="(ModifierForms) | Null" type="object">
        <type full="ArrayList" namespace="" name="ArrayList"/>
      </return>
    </docblock>
    <parameter name="optionalController" byreference="false" type="object" default="null">
      <type full="\\Controller" namespace="\" name="Controller"/>
    </parameter>
    <parameter name="optionalValidator" byreference="false" type="object" default="null">
      <type full="\\Validator" namespace="\" name="Validator"/>
    </parameter>
  </method>
  <method name="get_order_status_options" start="244" end="246" abstract="false" final="false" static="true" visibility="public">
    <docblock>
      <description compact="This function returns the OrderSteps"/>
      <return description="(OrderSteps)" type="object">
        <type full="ArrayList" namespace="" name="ArrayList"/>
      </return>
    </docblock>
  </method>
  <method name="get_by_id_if_can_view" start="253" end="263" abstract="false" final="false" static="true" visibility="public">
    <docblock>
      <description compact="Like the standard byID, but it checks whether we are allowed to view the order."/>
      <return description="Order | Null" type="object">
        <type full=":" namespace="" name=":"/>
      </return>
    </docblock>
    <parameter name="id" byreference="false" type="{unknown}"/>
    <inline>
      <comment value="LITTLE HACK TO MAKE SURE WE SHOW THE LATEST INFORMATION!" line="257"/>
    </inline>
  </method>
  <method name="get_datalist_of_orders_with_submit_record" start="272" end="285" abstract="false" final="false" static="true" visibility="public">
    <docblock>
      <description compact="returns a Datalist with the submitted order log included this allows you to sort the orders by their submit dates.">You can retrieve this list and then add more to it (e.g. additional filters, additional joins, etc...)</description>
      <param description="- only include Orders that have already been submitted." type="object" variable="$onlySubmittedOrders">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <return description="(Orders)" type="object">
        <type full="DataList" namespace="" name="DataList"/>
      </return>
    </docblock>
    <parameter name="onlySubmittedOrders" byreference="false" type="{unknown}" default="false"/>
  </method>
  <member name="fieldsAndTabsToBeRemoved" type="array" visibility="protected" line="297">
    <docblock>
      <description compact="fields that we remove from the parent::getCMSFields object set"/>
      <var type="object">
        <type full="Array" namespace="" name="Array"/>
      </var>
    </docblock>
  </member>
  <member name="summary_fields" type="array" visibility="private" line="318">
    <docblock>
      <description compact="STANDARD SILVERSTRIPE STUFF"/>
    </docblock>
  </member>
  <member name="searchable_fields" type="array" visibility="private" line="327">
    <docblock>
      <description compact="STANDARD SILVERSTRIPE STUFF"/>
      <todo value=": how to translate this?"/>
    </docblock>
  </member>
  <method name="scaffoldSearchFields" start="368" end="401" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Determine which properties on the DataObject are searchable, and map them to their default {@link FormField} representations. Used for scaffolding a searchform for {@link ModelAdmin}.">Some additional logic is included for switching field labels, based on
how generic or specific the field type is.
Used by <link xmlns="http://xml.phpdox.net/src#" value="SearchContext"/>.
</description>
      <param type="array" variable="$_params">'fieldClasses': Associative array of field names as keys and FormField classes as values
	'restrictFields': Numeric array of a field name whitelist</param>
      <return type="object">
        <type full="FieldList" namespace="" name="FieldList"/>
      </return>
    </docblock>
    <parameter name="_params" byreference="false" type="{unknown}" default="null"/>
  </method>
  <method name="CMSEditLink" start="408" end="414" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="link to edit the record"/>
      <param description="| Null $action - e.g. edit" type="object">
        <type full="String" namespace="" name="String"/>
      </param>
      <return type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
    <parameter name="action" byreference="false" type="{unknown}" default="null"/>
  </method>
  <method name="getCMSFields" start="420" end="591" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="STANDARD SILVERSTRIPE STUFF broken up into submitted and not (yet) submitted"/>
    </docblock>
    <inline>
      <todo value="" line="430"/>
      <comment value="Having trouble here, as when you submit the form (for example, a payment confirmation)" line="431"/>
      <comment value="as the step moves forward, meaning the fields generated are incorrect, causing an error" line="432"/>
      <comment value="&quot;I can't handle sub-URLs of a Form object.&quot; generated by the RequestHandler." line="433"/>
      <comment value="Therefore we need to try reload the page so that it will be requesting the correct URL to generate the correct fields for the current step" line="434"/>
      <comment value="Or something similar." line="435"/>
      <comment value="why not check if the URL == $this-&gt;CMSEditLink()" line="436"/>
      <comment value="and only tryToFinaliseOrder if this is true...." line="437"/>
      <comment value="Config::nest();" line="469"/>
      <comment value="Config::inst()-&gt;update('SSViewer', 'theme_enabled', true);" line="470"/>
      <comment value="$htmlSummary = $this-&gt;renderWith(&quot;Order&quot;);" line="471"/>
      <comment value="Config::unnest();" line="472"/>
      <comment value="member" line="494"/>
    </inline>
  </method>
  <method name="getOrderItemsField" start="597" end="601" abstract="false" final="false" static="false" visibility="protected">
    <docblock>
      <description compact="Field to add and edit Order Items"/>
      <return type="object">
        <type full="GridField" namespace="" name="GridField"/>
      </return>
    </docblock>
  </method>
  <method name="getModifierTableField" start="607" end="611" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Field to add and edit Modifiers"/>
      <return type="object">
        <type full="GridField" namespace="" name="GridField"/>
      </return>
    </docblock>
  </method>
  <method name="getBillingAddressField" start="617" end="630" abstract="false" final="false" static="false" visibility="protected">
    <docblock>
      <description compact="return GridField"/>
    </docblock>
    <inline>
      <comment value="$source = $this-&gt;BillingAddress();" line="627"/>
    </inline>
  </method>
  <method name="getShippingAddressField" start="637" end="650" abstract="false" final="false" static="false" visibility="protected">
    <docblock>
      <description compact="return GridField"/>
    </docblock>
    <inline>
      <comment value="$source = $this-&gt;ShippingAddress();" line="647"/>
    </inline>
  </method>
  <method name="getOrderStatusLogsTableField" start="661" end="671" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Needs to be public because the OrderStep::getCMSFIelds accesses it."/>
      <param type="object" variable="$sourceClass">
        <type full="String" namespace="" name="String"/>
      </param>
      <param type="object" variable="$title">
        <type full="String" namespace="" name="String"/>
      </param>
      <param description="(Optional)" type="object" variable="$fieldList">
        <type full="FieldList" namespace="" name="FieldList"/>
      </param>
      <param description="(Optional)" type="object" variable="$detailedFormFields">
        <type full="FieldList" namespace="" name="FieldList"/>
      </param>
      <return type="object">
        <type full="GridField" namespace="" name="GridField"/>
      </return>
    </docblock>
    <parameter name="sourceClass" byreference="false" type="string" default="&quot;OrderStatusLog&quot;"/>
    <parameter name="title" byreference="false" type="string" default="&quot;&quot;"/>
    <parameter name="fieldList" byreference="false" type="object" default="null">
      <type full="\\FieldList" namespace="\" name="FieldList"/>
    </parameter>
    <parameter name="detailedFormFields" byreference="false" type="object" default="null">
      <type full="\\FieldList" namespace="\" name="FieldList"/>
    </parameter>
  </method>
  <method name="getOrderStatusLogsTableField_Archived" start="681" end="688" abstract="false" final="false" static="false" visibility="protected">
    <docblock>
      <description/>
      <param type="object" variable="$sourceClass">
        <type full="String" namespace="" name="String"/>
      </param>
      <param type="object" variable="$title">
        <type full="String" namespace="" name="String"/>
      </param>
      <param description="(Optional)" type="object" variable="$fieldList">
        <type full="FieldList" namespace="" name="FieldList"/>
      </param>
      <param description="(Optional)" type="object" variable="$detailedFormFields">
        <type full="FieldList" namespace="" name="FieldList"/>
      </param>
      <return type="object">
        <type full="GridField" namespace="" name="GridField"/>
      </return>
    </docblock>
    <parameter name="sourceClass" byreference="false" type="string" default="&quot;OrderStatusLog&quot;"/>
    <parameter name="title" byreference="false" type="string" default="&quot;&quot;"/>
    <parameter name="fieldList" byreference="false" type="object" default="null">
      <type full="\\FieldList" namespace="\" name="FieldList"/>
    </parameter>
    <parameter name="detailedFormFields" byreference="false" type="object" default="null">
      <type full="\\FieldList" namespace="\" name="FieldList"/>
    </parameter>
  </method>
  <method name="getEmailsTableField" start="694" end="699" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <return type="object">
        <type full="GridField" namespace="" name="GridField"/>
      </return>
    </docblock>
  </method>
  <method name="getPaymentsField" start="705" end="711" abstract="false" final="false" static="false" visibility="protected">
    <docblock>
      <description/>
      <return type="object">
        <type full="GridField" namespace="" name="GridField"/>
      </return>
    </docblock>
  </method>
  <method name="OrderStepField" start="716" end="718" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <return type="object">
        <type full="OrderStepField" namespace="" name="OrderStepField"/>
      </return>
    </docblock>
  </method>
  <method name="init" start="736" end="797" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="init runs on start of a new Order (@see onAfterWrite) it adds all the modifiers to the orders and the starting OrderStep"/>
      <param type="object" variable="$recalculate">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <return description="(Order)" type="object">
        <type full="DataObject" namespace="" name="DataObject"/>
      </return>
    </docblock>
    <parameter name="recalculate" byreference="false" type="{unknown}" default="false"/>
  </method>
  <method name="tryToFinaliseOrder" start="804" end="816" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Goes through the order steps and tries to &quot;apply&quot; the next status to the order."/>
    </docblock>
    <inline>
      <comment value="status of order is being progressed" line="809"/>
      <comment value="a little hack to make sure we do not rely on a stored value" line="811"/>
      <comment value="of &quot;isSubmitted&quot;" line="812"/>
    </inline>
  </method>
  <method name="doNextStatus" start="822" end="833" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Goes through the order steps and tries to &quot;apply&quot; the next"/>
      <return description="(StatusID or false if the next status can not be &quot;applied&quot;)" type="object">
        <type full="Integer" namespace="" name="Integer"/>
      </return>
    </docblock>
  </method>
  <method name="Cancel" start="841" end="852" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="cancel an order."/>
      <param description="- the user cancelling the order" type="object" variable="$member">
        <type full="Member" namespace="" name="Member"/>
      </param>
      <param description="- the reason the order is cancelled" type="object" variable="$reason">
        <type full="String" namespace="" name="String"/>
      </param>
      <returns value="OrderStatusLog_Cancel"/>
    </docblock>
    <parameter name="member" byreference="false" type="object">
      <type full="\\Member" namespace="\" name="Member"/>
    </parameter>
    <parameter name="reason" byreference="false" type="string" default="&quot;&quot;"/>
  </method>
  <method name="MyStep" start="867" end="882" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <return description="(current OrderStep)" type="object">
        <type full="DataObject" namespace="" name="DataObject"/>
      </return>
    </docblock>
  </method>
  <method name="RelevantLogEntry" start="889" end="891" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Return the OrderStatusLog that is relevant to the Order status."/>
      <return type="object">
        <type full="OrderStatusLog" namespace="" name="OrderStatusLog"/>
      </return>
    </docblock>
  </method>
  <method name="CurrentStepVisibleToCustomer" start="896" end="905" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <return description="(current OrderStep that can be seen by customer)" type="object">
        <type full="DataObject" namespace="" name="DataObject"/>
      </return>
    </docblock>
  </method>
  <method name="IsFirstStep" start="911" end="920" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="works out if the order is still at the first OrderStep."/>
      <return type="boolean"/>
    </docblock>
  </method>
  <method name="IsInCart" start="926" end="928" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Is the order still being &quot;edited&quot; by the customer?"/>
      <return type="boolean"/>
    </docblock>
  </method>
  <method name="IsPastCart" start="934" end="936" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="The order has &quot;passed&quot; the IsInCart phase"/>
      <return type="boolean"/>
    </docblock>
  </method>
  <method name="IsUncomplete" start="942" end="944" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Are there still steps the order needs to go through?"/>
      <return type="boolean"/>
    </docblock>
  </method>
  <method name="IsProcessing" start="950" end="952" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Is the order in the :&quot;processing&quot; phaase.?"/>
      <return type="boolean"/>
    </docblock>
  </method>
  <method name="IsCompleted" start="958" end="960" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Is the order completed?"/>
      <return type="boolean"/>
    </docblock>
  </method>
  <method name="IsPaid" start="967" end="972" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Has the order been paid? TODO: why do we check if there is a total at all?"/>
      <return type="boolean"/>
    </docblock>
  </method>
  <method name="PaymentIsPending" start="979" end="993" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Has the order been paid? TODO: why do we check if there is a total at all?"/>
      <return type="boolean"/>
    </docblock>
  </method>
  <method name="IsCancelled" start="999" end="999" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Has the order been cancelled?"/>
      <return type="boolean"/>
    </docblock>
  </method>
  <method name="getIsCancelled" start="1000" end="1002" abstract="false" final="false" static="false" visibility="public"/>
  <method name="IsCustomerCancelled" start="1008" end="1013" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Has the order been cancelled by the customer?"/>
      <return type="boolean"/>
    </docblock>
  </method>
  <method name="IsAdminCancelled" start="1020" end="1032" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Has the order been cancelled by the  administrator?"/>
      <return type="boolean"/>
    </docblock>
  </method>
  <method name="ShopClosed" start="1039" end="1041" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Is the Shop Closed for business?"/>
      <return type="boolean"/>
    </docblock>
  </method>
  <method name="CreateOrReturnExistingMember" start="1070" end="1091" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Returns a member linked to the order.">If a member is already linked, it will return the existing member.
Otherwise it will return a new Member.

Any new member is NOT written, because we dont want to create a new member unless we have to!
We will not add a member to the order unless a new one is created in the checkout
OR the member is logged in / logs in.

Also note that if a new member is created, it is not automatically written</description>
      <param description="- if set to true then the member will always be saved in the database." type="object" variable="$forceCreation">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <return type="object">
        <type full="Member" namespace="" name="Member"/>
      </return>
    </docblock>
    <parameter name="forceCreation" byreference="false" type="{unknown}" default="false"/>
  </method>
  <method name="CreateOrReturnExistingAddress" start="1105" end="1145" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Returns either the existing one or a new Order Address...">All Orders will have a Shipping and Billing address attached to it.
Method used to retrieve object e.g. for $order-&gt;BillingAddress(); "BillingAddress" is the method name you can use.
If the method name is the same as the class name then dont worry about providing one.</description>
      <param description="- ClassName of the Address (e.g. BillingAddress or ShippingAddress)" type="object" variable="$className">
        <type full="String" namespace="" name="String"/>
      </param>
      <param description="- method to retrieve Address" type="object" variable="$alternativeMethodName">
        <type full="String" namespace="" name="String"/>
      </param>
      <return description="| OrderAddress" type="object">
        <type full="Null" namespace="" name="Null"/>
      </return>
    </docblock>
    <parameter name="className" byreference="false" type="string" default="&quot;BillingAddress&quot;"/>
    <parameter name="alternativeMethodName" byreference="false" type="string" default="''"/>
  </method>
  <method name="SetCountryFields" start="1153" end="1171" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Sets the country in the billing and shipping address"/>
      <param description="- code for the country e.g. NZ" type="object" variable="$countryCode">
        <type full="String" namespace="" name="String"/>
      </param>
      <param type="object" variable="$includeBillingAddress">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <param type="object" variable="$includeShippingAddress">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
    </docblock>
    <parameter name="countryCode" byreference="false" type="{unknown}"/>
    <parameter name="includeBillingAddress" byreference="false" type="{unknown}" default="true"/>
    <parameter name="includeShippingAddress" byreference="false" type="{unknown}" default="true"/>
  </method>
  <method name="SetRegionFields" start="1177" end="1191" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Sets the region in the billing and shipping address"/>
      <param description="- ID for the region to be set" type="object" variable="$regionID">
        <type full="Integer" namespace="" name="Integer"/>
      </param>
    </docblock>
    <parameter name="regionID" byreference="false" type="{unknown}"/>
  </method>
  <method name="UpdateCurrency" start="1198" end="1210" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Stores the preferred currency of the order.">IMPORTANTLY we store the exchange rate for future reference...</description>
      <param type="object" variable="$currency">
        <type full="EcommerceCurrency" namespace="" name="EcommerceCurrency"/>
      </param>
    </docblock>
    <parameter name="newCurrency" byreference="false" type="{unknown}"/>
  </method>
  <method name="SetCurrency" start="1215" end="1217" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="alias for UpdateCurrency"/>
    </docblock>
    <parameter name="currency" byreference="false" type="{unknown}"/>
  </method>
  <method name="sendEmail" start="1236" end="1238" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Send the invoice of the order by email."/>
      <param description="- subject for the email" type="object" variable="$subject">
        <type full="String" namespace="" name="String"/>
      </param>
      <param description="- the main message in the email" type="object" variable="$message">
        <type full="String" namespace="" name="String"/>
      </param>
      <param description="- send the email even if it has been sent before" type="object" variable="$resend">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <param description="- do not send to customer, only send to shop admin" type="object" variable="$adminOnly">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <param description="- class used to send email" type="object" variable="$emailClassName">
        <type full="String" namespace="" name="String"/>
      </param>
      <return description="TRUE on success, FALSE on failure (in theory)" type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </return>
    </docblock>
    <parameter name="subject" byreference="false" type="string" default="&quot;&quot;"/>
    <parameter name="message" byreference="false" type="string" default="&quot;&quot;"/>
    <parameter name="resend" byreference="false" type="{unknown}" default="false"/>
    <parameter name="adminOnly" byreference="false" type="{unknown}" default="false"/>
    <parameter name="emailClassName" byreference="false" type="string" default="'Order_InvoiceEmail'"/>
  </method>
  <method name="sendError" start="1248" end="1250" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Sends a message to the shop admin ONLY and not to the customer This can be used by ordersteps and orderlogs to notify the admin of any potential problems."/>
      <param description="- subject for the email" type="object" variable="$subject">
        <type full="String" namespace="" name="String"/>
      </param>
      <param description="- message to be added with the email" type="object" variable="$message">
        <type full="String" namespace="" name="String"/>
      </param>
      <return description="TRUE for success, FALSE for failure (not tested)" type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </return>
    </docblock>
    <parameter name="subject" byreference="false" type="string" default="&quot;&quot;"/>
    <parameter name="message" byreference="false" type="string" default="&quot;&quot;"/>
  </method>
  <method name="sendAdminNotification" start="1260" end="1262" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Sends a message to the shop admin ONLY and not to the customer This can be used by ordersteps and orderlogs to notify the admin of any potential problems."/>
      <param description="- subject for the email" type="object" variable="$subject">
        <type full="String" namespace="" name="String"/>
      </param>
      <param description="- message to be added with the email" type="object" variable="$message">
        <type full="String" namespace="" name="String"/>
      </param>
      <return description="TRUE for success, FALSE for failure (not tested)" type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </return>
    </docblock>
    <parameter name="subject" byreference="false" type="string" default="&quot;&quot;"/>
    <parameter name="message" byreference="false" type="string" default="&quot;&quot;"/>
  </method>
  <method name="prepareEmail" start="1275" end="1316" abstract="false" final="false" static="false" visibility="protected">
    <docblock>
      <description compact="Send a mail of the order to the client (and another to the admin)."/>
      <param description="- the class name of the email you wish to send" type="object" variable="$emailClassName">
        <type full="String" namespace="" name="String"/>
      </param>
      <param description="- email subject" type="object" variable="$subject">
        <type full="String" namespace="" name="String"/>
      </param>
      <param description="- true by default, whether it should send a copy to the admin" type="object" variable="$copyToAdmin">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <param description="- sends the email even it has been sent before." type="object" variable="$resend">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <param description="- sends the email to the ADMIN ONLY." type="object" variable="$adminOnly">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <return description="TRUE for success, FALSE for failure (not tested)" type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </return>
    </docblock>
    <parameter name="emailClassName" byreference="false" type="{unknown}"/>
    <parameter name="subject" byreference="false" type="{unknown}"/>
    <parameter name="message" byreference="false" type="{unknown}"/>
    <parameter name="resend" byreference="false" type="{unknown}" default="false"/>
    <parameter name="adminOnly" byreference="false" type="{unknown}" default="false"/>
    <inline>
      <comment value="why are we using this email and NOT the member.EMAIL?" line="1278"/>
      <comment value="for historical reasons????" line="1279"/>
      <comment value="we take the subject from the Array Data, just in case it has been adjusted." line="1293"/>
      <comment value="This might be called from within the CMS," line="1304"/>
      <comment value="so we need to restore the theme, just in case" line="1305"/>
      <comment value="templates within the theme exist" line="1306"/>
    </inline>
  </method>
  <method name="createReplacementArrayForEmail" start="1338" end="1361" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns the Data that can be used in the body of an order Email we add the subject here so that the subject, for example, can be added to the &lt;title&gt; of the email template.">we add the subject here so that the subject, for example, can be added to the &lt;title&gt;
of the email template.</description>
      <param description="- the additional message" type="object" variable="$message">
        <type full="String" namespace="" name="String"/>
      </param>
      <param description="- subject for email -" type="object" variable="$subject">
        <type full="String" namespace="" name="String"/>
      </param>
      <return type="object">- Subject - EmailSubject
- Message - specific message for this order
- OrderStepMessage - generic message for step
- Order
- EmailLogo
- ShopPhysicalAddress
- CurrentDateAndTime
- BaseURL
- CC
- BCC<type full="ArrayData" namespace="" name="ArrayData"/></return>
    </docblock>
    <parameter name="message" byreference="false" type="string" default="&quot;&quot;"/>
    <parameter name="subject" byreference="false" type="string" default="&quot;&quot;"/>
  </method>
  <method name="renderOrderInEmailFormat" start="1369" end="1377" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns the order formatted as an email"/>
      <param description="- the additional message" type="object" variable="$message">
        <type full="String" namespace="" name="String"/>
      </param>
      <param description="- template to use." type="object" variable="$emailClassName">
        <type full="String" namespace="" name="String"/>
      </param>
      <return description="(Message, Order, EmailLogo, ShopPhysicalAddress)" type="array"/>
    </docblock>
    <parameter name="message" byreference="false" type="string" default="&quot;&quot;"/>
    <parameter name="emailClassName" byreference="false" type="{unknown}"/>
  </method>
  <method name="getOrderAttributesByType" start="1396" end="1417" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns a list of Order Attributes by type"/>
      <param description="| String $types" type="object">
        <type full="Array" namespace="" name="Array"/>
      </param>
      <return type="object">
        <type full="ArrayList" namespace="" name="ArrayList"/>
      </return>
    </docblock>
    <parameter name="types" byreference="false" type="{unknown}"/>
  </method>
  <method name="Items" start="1425" end="1430" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Returns the items of the order.">Items are the order items (products) and NOT the modifiers (discount, tax, etc...)</description>
      <param description="filter - where statement to exclude certain items OR ClassName (e.g. 'TaxModifier')" type="object">
        <type full="String" namespace="" name="String"/>
      </param>
      <return description="(OrderItems)" type="object">
        <type full="DataList" namespace="" name="DataList"/>
      </return>
    </docblock>
    <parameter name="filterOrClassName" byreference="false" type="string" default="&quot;&quot;"/>
  </method>
  <method name="OrderItems" start="1437" end="1439" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <alias value="function of Items"/>
      <param description="filter - where statement to exclude certain items." type="object">
        <type full="String" namespace="" name="String"/>
      </param>
      <return description="(OrderItems)" type="object">
        <type full="DataList" namespace="" name="DataList"/>
      </return>
    </docblock>
    <parameter name="filterOrClassName" byreference="false" type="string" default="&quot;&quot;"/>
  </method>
  <method name="itemsFromDatabase" start="1448" end="1460" abstract="false" final="false" static="false" visibility="protected">
    <docblock>
      <description compact="Return all the {@link OrderItem} instances that are available as records in the database."/>
      <param description="filter - where statement to exclude certain items," type="object">you can also pass a classname (e.g. MyOrderItem), in which case only this class will be returned (and any class extending your given class)<type full="String" namespace="" name="String"/></param>
      <return description="(OrderItems)" type="object">
        <type full="DataList" namespace="" name="DataList"/>
      </return>
    </docblock>
    <parameter name="filterOrClassName" byreference="false" type="string" default="&quot;&quot;"/>
  </method>
  <method name="OrderModifiers" start="1466" end="1468" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <alias value="for Modifiers"/>
      <return description="(OrderModifiers)" type="object">
        <type full="DataList" namespace="" name="DataList"/>
      </return>
    </docblock>
  </method>
  <method name="Modifiers" start="1477" end="1479" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Returns the modifiers of the order, if it hasn't been saved yet it returns the modifiers from session, if it has, it returns them from the DB entry. ONLY USE OUTSIDE ORDER"/>
      <param description="filter - where statement to exclude certain items OR ClassName (e.g. 'TaxModifier')" type="object">
        <type full="String" namespace="" name="String"/>
      </param>
      <return description="(OrderModifiers)" type="object">
        <type full="DataList" namespace="" name="DataList"/>
      </return>
    </docblock>
    <parameter name="filterOrClassName" byreference="false" type="string" default="''"/>
  </method>
  <method name="modifiersFromDatabase" start="1488" end="1500" abstract="false" final="false" static="false" visibility="protected">
    <docblock>
      <description compact="Get all {@link OrderModifier} instances that are available as records in the database.">NOTE: includes REMOVED Modifiers, so that they do not get added again...</description>
      <param description="filter - where statement to exclude certain items OR ClassName (e.g. 'TaxModifier')" type="object">
        <type full="String" namespace="" name="String"/>
      </param>
      <return description="(OrderModifiers)" type="object">
        <type full="DataList" namespace="" name="DataList"/>
      </return>
    </docblock>
    <parameter name="filterOrClassName" byreference="false" type="string" default="''"/>
  </method>
  <method name="calculateOrderAttributes" start="1507" end="1520" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Calculates and updates all the order attributes."/>
      <param description="- run it, even if it has run already" type="object" variable="$recalculate">
        <type full="Bool" namespace="" name="Bool"/>
      </param>
    </docblock>
    <parameter name="recalculate" byreference="false" type="{unknown}" default="false"/>
  </method>
  <method name="calculateOrderItems" start="1527" end="1540" abstract="false" final="false" static="false" visibility="protected">
    <docblock>
      <description compact="Calculates and updates all the product items."/>
      <param description="- run it, even if it has run already" type="object" variable="$recalculate">
        <type full="Bool" namespace="" name="Bool"/>
      </param>
    </docblock>
    <parameter name="recalculate" byreference="false" type="{unknown}" default="false"/>
    <inline>
      <comment value="check if order has modifiers already" line="1528"/>
      <comment value="check /re-add all non-removable ones" line="1529"/>
      <comment value="$start = microtime();" line="1530"/>
    </inline>
  </method>
  <method name="calculateModifiers" start="1549" end="1559" abstract="false" final="false" static="false" visibility="protected">
    <docblock>
      <description compact="Calculates and updates all the modifiers."/>
      <param description="- run it, even if it has run already" type="object" variable="$recalculate">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
    </docblock>
    <parameter name="recalculate" byreference="false" type="{unknown}" default="false"/>
  </method>
  <method name="ModifiersSubTotal" start="1571" end="1596" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Returns the subtotal of the modifiers for this order.">If a modifier appears in the excludedModifiers array, it is not counted.</description>
      <param description="- Class(es) of modifier(s) to ignore in the calculation." type="object" variable="$excluded">
        <type full="string|array" namespace="" name="string|array"/>
      </param>
      <param description="- when this flag is TRUE, we stop adding the modifiers when we reach an excluded modifier." type="object" variable="$stopAtExcludedModifier">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <return type="object">
        <type full="Float" namespace="" name="Float"/>
      </return>
    </docblock>
    <parameter name="excluded" byreference="false" type="{unknown}" default="null"/>
    <parameter name="stopAtExcludedModifier" byreference="false" type="{unknown}" default="false"/>
    <inline>
      <comment value="we just double-check this..." line="1576"/>
      <comment value="do the next modifier" line="1581"/>
    </inline>
  </method>
  <method name="RetrieveModifier" start="1604" end="1613" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns a modifier that is an instanceof the classname it extends"/>
      <param description="class name for the modifier" type="object" variable="$className:">
        <type full="String" namespace="" name="String"/>
      </param>
      <return description="(OrderModifier)" type="object">
        <type full="DataObject" namespace="" name="DataObject"/>
      </return>
    </docblock>
    <parameter name="className" byreference="false" type="{unknown}"/>
  </method>
  <method name="getMemberForCanFunctions" start="1625" end="1632" abstract="false" final="false" static="false" visibility="protected">
    <parameter name="member" byreference="false" type="object" default="null">
      <type full="\\Member" namespace="\" name="Member"/>
    </parameter>
  </method>
  <method name="canCreate" start="1638" end="1645" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <param type="object" variable="$member">
        <type full="Member" namespace="" name="Member"/>
      </param>
      <return type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </return>
    </docblock>
    <parameter name="member" byreference="false" type="{unknown}" default="null"/>
  </method>
  <method name="canView" start="1652" end="1724" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Standard SS method - can the current member view this order?"/>
      <param type="object" variable="$member">
        <type full="Member" namespace="" name="Member"/>
      </param>
      <return type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </return>
    </docblock>
    <parameter name="member" byreference="false" type="{unknown}" default="null"/>
    <inline>
      <comment value="check if this has been &quot;altered&quot; in any DataExtension" line="1657"/>
      <comment value="if this method has been extended in a data object decorator then use this" line="1659"/>
      <comment value="is the member is a shop admin they can always view it" line="1663"/>
      <comment value="if the current member OWNS the order, (s)he can always view it." line="1667"/>
      <comment value="it is the current order" line="1671"/>
      <comment value="we do some additional CHECKS for session hackings!" line="1674"/>
      <comment value="must be the same member!" line="1676"/>
      <comment value="if the session ID matches, we can always view it." line="1711"/>
      <comment value="SECURITYL RISK: if you know someone else his/her session" line="1712"/>
      <comment value="OR you can view the sessions on the server" line="1713"/>
      <comment value="OR you can guess the session" line="1714"/>
      <comment value="THEN you can view the order." line="1715"/>
      <comment value="by viewing the order you can also access some of the member details." line="1716"/>
      <comment value="NB: this MUST be the last resort! If all other methods fail." line="1717"/>
      <comment value="That is, if we are working with the current order then it is a good idea" line="1718"/>
      <comment value="to deny non-matching members." line="1719"/>
    </inline>
  </method>
  <method name="IsInSession" start="1731" end="1733" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <return type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </return>
    </docblock>
  </method>
  <method name="canEdit" start="1745" end="1756" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="if we set canEdit to false then we can not see the child records Basically, you can edit when you can view and canEdit (even as a customer) Or if you are a Shop Admin you can always edit.">Otherwise it is false...</description>
      <param type="object" variable="$member">
        <type full="Member" namespace="" name="Member"/>
      </param>
      <return type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </return>
    </docblock>
    <parameter name="member" byreference="false" type="{unknown}" default="null"/>
  </method>
  <method name="canPay" start="1763" end="1771" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Can a payment be made for this Order?"/>
      <param type="object" variable="$member">
        <type full="Member" namespace="" name="Member"/>
      </param>
      <return type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </return>
    </docblock>
    <parameter name="member" byreference="false" type="object" default="null">
      <type full="\\Member" namespace="\" name="Member"/>
    </parameter>
  </method>
  <method name="canCancel" start="1778" end="1788" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Can the given member cancel this order?"/>
      <param type="object" variable="$member">
        <type full="Member" namespace="" name="Member"/>
      </param>
      <return type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </return>
    </docblock>
    <parameter name="member" byreference="false" type="object" default="null">
      <type full="\\Member" namespace="\" name="Member"/>
    </parameter>
    <inline>
      <comment value="if it is already cancelled it can be cancelled again" line="1779"/>
    </inline>
  </method>
  <method name="canDelete" start="1795" end="1804" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <param type="object" variable="$member">
        <type full="Member" namespace="" name="Member"/>
      </param>
      <return type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </return>
    </docblock>
    <parameter name="member" byreference="false" type="{unknown}" default="null"/>
  </method>
  <method name="CanViewOrderStatusLogs" start="1813" end="1822" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Returns all the order logs that the current member can view i.e. some order logs can only be viewed by the admin (e.g. suspected fraud orderlog)."/>
      <return description="(OrderStatusLogs)" type="object">
        <type full="ArrayList" namespace="" name="ArrayList"/>
      </return>
    </docblock>
  </method>
  <method name="CustomerViewableOrderStatusLogs" start="1828" end="1839" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns all the logs that can be viewed by the customer."/>
      <return description="(OrderStausLogs)" type="object">
        <type full="ArrayList" namespace="" name="ArrayList"/>
      </return>
    </docblock>
  </method>
  <method name="OrderEmail" start="1856" end="1856" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns the email to be used for customer communication"/>
      <return type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
  </method>
  <method name="getOrderEmail" start="1857" end="1872" abstract="false" final="false" static="false" visibility="public"/>
  <method name="HasPrintOrEmailLink" start="1878" end="1880" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Returns true if there is a prink or email link."/>
      <return type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </return>
    </docblock>
  </method>
  <method name="EmailLink" start="1886" end="1886" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns the absolute link to the order that can be used in the customer communication (email)"/>
      <return type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
    <parameter name="type" byreference="false" type="string" default="&quot;Order_StatusEmail&quot;"/>
  </method>
  <method name="getEmailLink" start="1887" end="1893" abstract="false" final="false" static="false" visibility="public">
    <parameter name="type" byreference="false" type="string" default="&quot;Order_StatusEmail&quot;"/>
  </method>
  <method name="PrintLink" start="1899" end="1899" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns the absolute link to the order for printing"/>
      <return type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
  </method>
  <method name="getPrintLink" start="1900" end="1906" abstract="false" final="false" static="false" visibility="public"/>
  <method name="PackingSlipLink" start="1912" end="1912" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns the absolute link to the order for printing"/>
      <return type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
  </method>
  <method name="getPackingSlipLink" start="1913" end="1919" abstract="false" final="false" static="false" visibility="public"/>
  <method name="RetrieveLink" start="1927" end="1927" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns the absolute link that the customer can use to retrieve the email WITHOUT logging in."/>
      <todo value=": is this a security risk?"/>
      <return type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
  </method>
  <method name="getRetrieveLink" start="1928" end="1940" abstract="false" final="false" static="false" visibility="public">
    <inline>
      <comment value="add session if not added yet..." line="1930"/>
    </inline>
  </method>
  <method name="DeleteLink" start="1946" end="1946" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="link to delete order."/>
      <return type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
  </method>
  <method name="getDeleteLink" start="1947" end="1954" abstract="false" final="false" static="false" visibility="public"/>
  <method name="CopyOrderLink" start="1960" end="1960" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="link to copy order."/>
      <return type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
  </method>
  <method name="getCopyOrderLink" start="1961" end="1968" abstract="false" final="false" static="false" visibility="public"/>
  <method name="Title" start="1978" end="1978" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="A &quot;Title&quot; for the order, which summarises the main details (date, and customer) in a string."/>
      <param description="- e.g. &quot;D j M Y, G:i T&quot;" type="object" variable="$dateFormat">
        <type full="String" namespace="" name="String"/>
      </param>
      <param description="- e.g. by Mr Johnson" type="object" variable="$includeName">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <return type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
    <parameter name="dateFormat" byreference="false" type="{unknown}" default="null"/>
    <parameter name="includeName" byreference="false" type="{unknown}" default="false"/>
  </method>
  <method name="getTitle" start="1979" end="2037" abstract="false" final="false" static="false" visibility="public">
    <parameter name="dateFormat" byreference="false" type="{unknown}" default="null"/>
    <parameter name="includeName" byreference="false" type="{unknown}" default="false"/>
  </method>
  <method name="SubTotal" start="2045" end="2045" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Returns the subtotal of the items for this order."/>
      <return type="float"/>
    </docblock>
  </method>
  <method name="getSubTotal" start="2046" end="2057" abstract="false" final="false" static="false" visibility="public"/>
  <method name="SubTotalAsCurrencyObject" start="2063" end="2065" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <return description="(DB Object)" type="object">
        <type full="Currency" namespace="" name="Currency"/>
      </return>
    </docblock>
  </method>
  <method name="SubTotalAsMoney" start="2071" end="2071" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <return type="object">
        <type full="Money" namespace="" name="Money"/>
      </return>
    </docblock>
  </method>
  <method name="getSubTotalAsMoney" start="2072" end="2074" abstract="false" final="false" static="false" visibility="public"/>
  <method name="ModifiersSubTotalAsCurrencyObject" start="2084" end="2086" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <param description="- Class(es) of modifier(s) to ignore in the calculation." type="object" variable="$excluded">
        <type full="string|array" namespace="" name="string|array"/>
      </param>
      <param description="- when this flag is TRUE, we stop adding the modifiers when we reach an excluded modifier." type="object" variable="$stopAtExcludedModifier">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <return description="(DB Object)" type="object">
        <type full="Currency" namespace="" name="Currency"/>
      </return>
    </docblock>
    <parameter name="excluded" byreference="false" type="{unknown}" default="null"/>
    <parameter name="stopAtExcludedModifier" byreference="false" type="{unknown}" default="false"/>
  </method>
  <method name="ModifiersSubTotalAsMoneyObject" start="2095" end="2097" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <param description="- Class(es) of modifier(s) to ignore in the calculation." type="object" variable="$excluded">
        <type full="string|array" namespace="" name="string|array"/>
      </param>
      <param description="- when this flag is TRUE, we stop adding the modifiers when we reach an excluded modifier." type="object" variable="$stopAtExcludedModifier">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <return description="(DB Object)" type="object">
        <type full="Money" namespace="" name="Money"/>
      </return>
    </docblock>
    <parameter name="excluded" byreference="false" type="{unknown}" default="null"/>
    <parameter name="stopAtExcludedModifier" byreference="false" type="{unknown}" default="false"/>
  </method>
  <method name="Total" start="2103" end="2103" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Returns the total cost of an order including the additional charges or deductions of its modifiers."/>
      <return type="float"/>
    </docblock>
  </method>
  <method name="getTotal" start="2104" end="2106" abstract="false" final="false" static="false" visibility="public"/>
  <method name="TotalAsCurrencyObject" start="2112" end="2114" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <return description="(DB Object)" type="object">
        <type full="Currency" namespace="" name="Currency"/>
      </return>
    </docblock>
  </method>
  <method name="TotalAsMoney" start="2120" end="2120" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <return type="object">
        <type full="Money" namespace="" name="Money"/>
      </return>
    </docblock>
  </method>
  <method name="getTotalAsMoney" start="2121" end="2123" abstract="false" final="false" static="false" visibility="public"/>
  <method name="TotalOutstanding" start="2132" end="2132" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Checks to see if any payments have been made on this order and if so, subracts the payment amount from the order"/>
      <return type="float"/>
    </docblock>
  </method>
  <method name="getTotalOutstanding" start="2133" end="2147" abstract="false" final="false" static="false" visibility="public"/>
  <method name="TotalOutstandingAsCurrencyObject" start="2153" end="2155" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <return description="(DB Object)" type="object">
        <type full="Currency" namespace="" name="Currency"/>
      </return>
    </docblock>
  </method>
  <method name="TotalOutstandingAsMoney" start="2161" end="2161" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <return type="object">
        <type full="Money" namespace="" name="Money"/>
      </return>
    </docblock>
  </method>
  <method name="getTotalOutstandingAsMoney" start="2162" end="2164" abstract="false" final="false" static="false" visibility="public"/>
  <method name="TotalPaid" start="2170" end="2170" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <return type="float"/>
    </docblock>
  </method>
  <method name="getTotalPaid" start="2171" end="2185" abstract="false" final="false" static="false" visibility="public"/>
  <method name="TotalPaidAsCurrencyObject" start="2191" end="2193" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <return description="(DB Object)" type="object">
        <type full="Currency" namespace="" name="Currency"/>
      </return>
    </docblock>
  </method>
  <method name="TotalPaidAsMoney" start="2199" end="2199" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <return type="object">
        <type full="Money" namespace="" name="Money"/>
      </return>
    </docblock>
  </method>
  <method name="getTotalPaidAsMoney" start="2200" end="2202" abstract="false" final="false" static="false" visibility="public"/>
  <method name="TotalItems" start="2213" end="2213" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns the total number of OrderItems (not modifiers).">This is meant to run as fast as possible to quickly check
if there is anything in the cart.</description>
      <param description="- do we need to recalculate (value is retained during lifetime of Object)" type="object" variable="$recalculate">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <return type="object">
        <type full="Integer" namespace="" name="Integer"/>
      </return>
    </docblock>
    <parameter name="recalculate" byreference="false" type="{unknown}" default="false"/>
  </method>
  <method name="getTotalItems" start="2214" end="2221" abstract="false" final="false" static="false" visibility="public">
    <parameter name="recalculate" byreference="false" type="{unknown}" default="false"/>
  </method>
  <method name="MoreThanOneItemInCart" start="2228" end="2230" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Little shorthand"/>
      <param type="object" variable="$recalculate">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <return type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </return>
    </docblock>
    <parameter name="recalculate" byreference="false" type="{unknown}" default="false"/>
  </method>
  <method name="TotalItemsTimesQuantity" start="2238" end="2238" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns the total number of OrderItems (not modifiers) times their respectective quantities."/>
      <param description="- force recalculation" type="object" variable="$recalculate">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <return type="object">
        <type full="Double" namespace="" name="Double"/>
      </return>
    </docblock>
    <parameter name="recalculate" byreference="false" type="{unknown}" default="false"/>
  </method>
  <method name="getTotalItemsTimesQuantity" start="2239" end="2252" abstract="false" final="false" static="false" visibility="public">
    <parameter name="recalculate" byreference="false" type="{unknown}" default="false"/>
    <inline>
      <comment value="to do, why do we check if you can edit ????" line="2241"/>
    </inline>
  </method>
  <method name="Country" start="2259" end="2259" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Returns the country code for the country that applies to the order.">It only takes into account what has actually been saved.</description>
      <return description="(country code)" type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
  </method>
  <method name="getCountry" start="2260" end="2294" abstract="false" final="false" static="false" visibility="public"/>
  <method name="FullNameCountry" start="2300" end="2300" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns name of coutry"/>
      <return description="- country name" type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
  </method>
  <method name="getFullNameCountry" start="2301" end="2303" abstract="false" final="false" static="false" visibility="public"/>
  <method name="ExpectedCountryName" start="2312" end="2312" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns name of coutry that we expect the customer to have This takes into consideration more than just what has been entered for example, it looks at GEO IP"/>
      <todo value=": why do we dont return a string IF there is only one item."/>
      <return description="- country name" type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
  </method>
  <method name="getExpectedCountryName" start="2313" end="2315" abstract="false" final="false" static="false" visibility="public"/>
  <method name="FixedCountry" start="2321" end="2321" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="return the title of the fixed country (if any)"/>
      <return description="| empty string" type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
  </method>
  <method name="getFixedCountry" start="2322" end="2328" abstract="false" final="false" static="false" visibility="public"/>
  <method name="Region" start="2336" end="2336" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Returns the region that applies to the order.">we check both billing and shipping, in case one of them is empty.</description>
      <return description="| Null (EcommerceRegion)" type="object">
        <type full="DataObject" namespace="" name="DataObject"/>
      </return>
    </docblock>
  </method>
  <method name="getRegion" start="2337" end="2370" abstract="false" final="false" static="false" visibility="public">
    <inline>
      <comment value="note the double-check with $this-&gt;CanHaveShippingAddress() and get_use_...." line="2359"/>
    </inline>
  </method>
  <method name="HasAlternativeCurrency" start="2377" end="2377" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Casted variable Currency is not the same as the standard one?"/>
      <return type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </return>
    </docblock>
  </method>
  <method name="getHasAlternativeCurrency" start="2378" end="2390" abstract="false" final="false" static="false" visibility="public"/>
  <method name="EnsureCorrectExchangeRate" start="2396" end="2414" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Makes sure exchange rate is updated and maintained before order is submitted This method is public because it could be called from a shopping Cart Object."/>
    </docblock>
  </method>
  <member name="isSubmittedTempVar" type="integer" default="1" visibility="protected" line="2421">
    <docblock>
      <description compact="speeds up processing by storing the IsSubmitted value we start with -1 to know if it has been requested before."/>
      <var type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </var>
    </docblock>
  </member>
  <method name="IsSubmitted" start="2428" end="2428" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Casted variable - has the order been submitted?"/>
      <param type="object" variable="$recalculate">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <return type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </return>
    </docblock>
    <parameter name="recalculate" byreference="false" type="{unknown}" default="false"/>
  </method>
  <method name="getIsSubmitted" start="2429" end="2439" abstract="false" final="false" static="false" visibility="public">
    <parameter name="recalculate" byreference="false" type="{unknown}" default="false"/>
  </method>
  <method name="SubmissionLog" start="2447" end="2452" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Submission Log for this Order (if any)"/>
      <return description="Log (OrderStatusLog_Submitted) | Null" type="object">
        <type full="Submission" namespace="" name="Submission"/>
      </return>
    </docblock>
  </method>
  <method name="CustomerStatus" start="2459" end="2459" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Casted variable - has the order been submitted?"/>
      <param type="object" variable="$withDetail">
        <type full="Boolean" namespace="" name="Boolean"/>
      </param>
      <return type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
    <parameter name="withDetail" byreference="false" type="{unknown}" default="true"/>
  </method>
  <method name="getCustomerStatus" start="2460" end="2471" abstract="false" final="false" static="false" visibility="public">
    <parameter name="withDetail" byreference="false" type="{unknown}" default="true"/>
  </method>
  <method name="CanHaveShippingAddress" start="2479" end="2479" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Casted variable - does the order have a potential shipping address?"/>
      <return type="object">
        <type full="Boolean" namespace="" name="Boolean"/>
      </return>
    </docblock>
  </method>
  <method name="getCanHaveShippingAddress" start="2480" end="2482" abstract="false" final="false" static="false" visibility="public"/>
  <method name="DisplayPage" start="2491" end="2507" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns the link to view the Order WHY NOT CHECKOUT PAGE: first we check for cart page."/>
      <return description="| Null" type="object">
        <type full="CartPage" namespace="" name="CartPage"/>
      </return>
    </docblock>
  </method>
  <method name="Link" start="2517" end="2531" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns the link to view the Order WHY NOT CHECKOUT PAGE: first we check for cart page.">If a cart page has been created then we refer through to Cart Page.
Otherwise it will default to the checkout page</description>
      <param description="- any action that should be added to the link." type="object" variable="$action">
        <type full="String" namespace="" name="String"/>
      </param>
      <return type="object">
        <type full="String(URLSegment)" namespace="" name="String(URLSegment)"/>
      </return>
    </docblock>
    <parameter name="action" byreference="false" type="{unknown}" default="null"/>
  </method>
  <method name="APILink" start="2539" end="2541" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Returns to link to access the Order's API"/>
      <param type="object" variable="$version">
        <type full="String" namespace="" name="String"/>
      </param>
      <param type="object" variable="$extension">
        <type full="String" namespace="" name="String"/>
      </param>
      <return type="object">
        <type full="String(URL)" namespace="" name="String(URL)"/>
      </return>
    </docblock>
    <parameter name="version" byreference="false" type="string" default="&quot;v1&quot;"/>
    <parameter name="extension" byreference="false" type="string" default="&quot;xml&quot;"/>
  </method>
  <method name="CheckoutLink" start="2547" end="2560" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns the link to finalise the Order"/>
      <return type="object">
        <type full="String(URLSegment)" namespace="" name="String(URLSegment)"/>
      </return>
    </docblock>
  </method>
  <method name="ConvertToHTML" start="2566" end="2573" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Converts the Order into HTML, based on the Order Template."/>
      <return description="Object" type="object">
        <type full="HTML" namespace="" name="HTML"/>
      </return>
    </docblock>
  </method>
  <method name="ConvertToString" start="2580" end="2582" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Converts the Order into a serialized string TO DO: check if this works and check if we need to use special sapphire serialization code"/>
      <return description="- serialized object" type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
  </method>
  <method name="ConvertToJSON" start="2589" end="2591" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Converts the Order into a JSON object TO DO: check if this works and check if we need to use special sapphire JSON code"/>
      <return description="-  JSON" type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
  </method>
  <method name="addHasOneAndHasManyAsVariables" start="2599" end="2609" abstract="false" final="false" static="false" visibility="protected">
    <docblock>
      <description compact="returns itself wtih more data added as variables.">We add has_one and has_many as variables like this: $this-&gt;MyHasOne_serialized = serialize($this-&gt;MyHasOne())</description>
      <return description="- with most important has one and has many items included as variables." type="object">
        <type full="Order" namespace="" name="Order"/>
      </return>
    </docblock>
  </method>
  <method name="AJAXDefinitions" start="2625" end="2627" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns the instance of EcommerceConfigAjax for use in templates.">In templates, it is used like this:
$EcommerceConfigAjax.TableID</description>
      <return type="object">
        <type full="EcommerceConfigAjax" namespace="" name="EcommerceConfigAjax"/>
      </return>
    </docblock>
  </method>
  <method name="EcomConfig" start="2634" end="2636" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="returns the instance of EcommerceDBConfig"/>
      <return type="object">
        <type full="EcommerceDBConfig" namespace="" name="EcommerceDBConfig"/>
      </return>
    </docblock>
  </method>
  <method name="updateForAjax" start="2643" end="2693" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Collects the JSON data for an ajax return of the cart."/>
      <param type="object" variable="$js">
        <type full="Array" namespace="" name="Array"/>
      </param>
      <return description="(for use in AJAX for JSON)" type="object">
        <type full="Array" namespace="" name="Array"/>
      </return>
    </docblock>
    <parameter name="js" byreference="false" type="array"/>
  </method>
  <method name="SubTotalCartValue" start="2699" end="2701" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description/>
      <todo value=": move to more appropriate class"/>
      <return type="object">
        <type full="Float" namespace="" name="Float"/>
      </return>
    </docblock>
  </method>
  <method name="populateDefaults" start="2716" end="2718" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="tandard SS method"/>
    </docblock>
  </method>
  <method name="onBeforeWrite" start="2720" end="2725" abstract="false" final="false" static="false" visibility="public"/>
  <method name="onAfterWrite" start="2731" end="2750" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="standard SS method adds the ability to update order after writing it."/>
    </docblock>
    <inline>
      <comment value="crucial!" line="2733"/>
    </inline>
  </method>
  <method name="onBeforeDelete" start="2758" end="2802" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="tandard SS method">delete attributes, statuslogs, and payments
THIS SHOULD NOT BE USED AS ORDERS SHOULD BE CANCELLED NOT DELETED</description>
    </docblock>
  </method>
  <method name="debug" start="2818" end="2821" abstract="false" final="false" static="false" visibility="public">
    <docblock>
      <description compact="Debug helper method.">Can be called from /shoppingcart/debug/</description>
      <return type="object">
        <type full="String" namespace="" name="String"/>
      </return>
    </docblock>
  </method>
  <interface full="EditableEcommerceObject" namespace="" name="EditableEcommerceObject">
    <method name="CMSEditLink" start="18" end="18" abstract="false" final="false" static="false" visibility="public">
      <docblock>
        <description compact="returns the link to edit the object"/>
        <param description="| Null $action" type="object">
          <type full="String" namespace="" name="String"/>
        </param>
        <return type="object">
          <type full="String" namespace="" name="String"/>
        </return>
      </docblock>
      <parameter name="action" byreference="false" type="{unknown}" default="null"/>
    </method>
  </interface>
</class>
