<?xml version="1.0" encoding="UTF-8"?>
<class xmlns="http://xml.phpdox.net/src#" full="Emogrifier" namespace="" name="Emogrifier" abstract="false" final="false" start="42" end="397">
  <file path="./../../../thirdparty" file="Emogrifier.php" realpath="/var/www/3.1.silverstripe-ecommerce.com/ecommerce/thirdparty/Emogrifier.php" size="20403" time="2014-05-11T15:45:02+12:00" unixtime="1399779902" sha1="22f6c3fb98378d643e71149eaa0171241a2e5aa1"/>
  <constant name="INDEX" value="0"/>
  <constant name="MULTIPLIER" value="1"/>
  <member name="html" type="string" default="''" visibility="private" line="48"/>
  <member name="css" type="string" default="''" visibility="private" line="49"/>
  <member name="unprocessableHTMLTags" type="array" visibility="private" line="50"/>
  <member name="caches" type="array" visibility="private" line="51"/>
  <member name="preserveEncoding" type="{unknown}" default="false" visibility="public" line="58"/>
  <constructor name="__construct" start="60" end="64" abstract="false" final="false" static="false" visibility="public">
    <parameter name="html" byreference="false" type="string" default="''"/>
    <parameter name="css" byreference="false" type="string" default="''"/>
  </constructor>
  <method name="setHTML" start="66" end="66" abstract="false" final="false" static="false" visibility="public">
    <parameter name="html" byreference="false" type="string" default="''"/>
  </method>
  <method name="setCSS" start="67" end="70" abstract="false" final="false" static="false" visibility="public">
    <parameter name="css" byreference="false" type="string" default="''"/>
  </method>
  <method name="clearCache" start="72" end="82" abstract="false" final="false" static="false" visibility="public">
    <parameter name="key" byreference="false" type="{unknown}" default="null"/>
  </method>
  <method name="addUnprocessableHTMLTag" start="88" end="88" abstract="false" final="false" static="false" visibility="public">
    <parameter name="tag" byreference="false" type="{unknown}"/>
  </method>
  <method name="removeUnprocessableHTMLTag" start="89" end="92" abstract="false" final="false" static="false" visibility="public">
    <parameter name="tag" byreference="false" type="{unknown}"/>
  </method>
  <method name="emogrify" start="95" end="248" abstract="false" final="false" static="false" visibility="public">
    <inline>
      <comment value="remove any unprocessable HTML tags (tags that DOMDocument cannot parse; this includes wbr and many new HTML5 tags)" line="98"/>
      <comment value="before be begin processing the CSS file, parse the document and normalize all existing CSS attributes (changes 'DISPLAY: none' to 'display: none');" line="116"/>
      <comment value="we wouldn't have to do this if DOMXPath supported XPath 2.0." line="117"/>
      <comment value="also store a reference of nodes with existing inline styles so we don't overwrite them" line="118"/>
      <comment value="in order to not overwrite existing style attributes in the HTML, we have to save the original HTML styles" line="124"/>
      <comment value="grab any existing style blocks from the html and append them to the existing CSS" line="134"/>
      <comment value="(these blocks should be appended so as to have precedence over conflicting styles in the existing CSS)" line="135"/>
      <comment value="append the css" line="139"/>
      <comment value="remove the &lt;style&gt; node" line="141"/>
      <comment value="filter the CSS" line="145"/>
      <comment value="process the CSS file for selectors and definitions" line="167"/>
      <comment value="if there is a blank definition, skip" line="172"/>
      <comment value="else split by commas and duplicate attributes so we can sort by selector precedence" line="175"/>
      <comment value="don't process pseudo-elements and behavioral (dynamic) pseudo-classes; ONLY allow structural pseudo-classes" line="179"/>
      <comment value="now sort the selectors by precedence" line="189"/>
      <comment value="query the body for the xpath selector" line="197"/>
      <comment value="if it has a style attribute, get it, process it, and append (overwrite) new stuff" line="201"/>
      <comment value="break it up into an associative array" line="203"/>
      <comment value="new styles overwrite the old styles (not technically accurate, but close enough)" line="207"/>
      <comment value="now iterate through the nodes that contained inline styles in the original HTML" line="219"/>
      <comment value="This removes styles from your email that contain display:none." line="231"/>
      <comment value="We need to look for display:none, but we need to do a case-insensitive search. Since DOMDocument only supports XPath 1.0," line="232"/>
      <comment value="lower-case() isn't available to us. We've thus far only set attributes to lowercase, not attribute values. Consequently, we need" line="233"/>
      <comment value="to translate() the letters that would be in 'NONE' (&quot;NOE&quot;) to lowercase." line="234"/>
      <comment value="The checks on parentNode and is_callable below ensure that if we've deleted the parent node," line="236"/>
      <comment value="we don't try to call removeChild on a nonexistent child node" line="237"/>
    </inline>
  </method>
  <method name="sortBySelectorPrecedence" start="250" end="257" abstract="false" final="false" static="false" visibility="private">
    <parameter name="a" byreference="false" type="{unknown}"/>
    <parameter name="b" byreference="false" type="{unknown}"/>
    <inline>
      <comment value="we want these sorted ascendingly so selectors with lesser precedence get processed first and" line="254"/>
      <comment value="selectors with greater precedence get sorted last" line="255"/>
    </inline>
  </method>
  <method name="getCSSSelectorPrecedence" start="259" end="277" abstract="false" final="false" static="false" visibility="private">
    <parameter name="selector" byreference="false" type="{unknown}"/>
    <inline>
      <comment value="ids: worth 100, classes: worth 10, elements: worth 1" line="264"/>
    </inline>
  </method>
  <method name="translateCSStoXpath" start="281" end="321" abstract="false" final="false" static="false" visibility="private">
    <parameter name="css_selector" byreference="false" type="{unknown}"/>
    <inline>
      <comment value="returns an Xpath selector" line="286"/>
      <comment value="advanced selectors are going to require a bit more advanced emogrification" line="313"/>
      <comment value="if we required PHP 5.3 we could do this with closures" line="314"/>
    </inline>
  </method>
  <method name="translateNthChild" start="323" end="337" abstract="false" final="false" static="false" visibility="private">
    <parameter name="match" byreference="false" type="{unknown}"/>
  </method>
  <method name="translateNthOfType" start="339" end="353" abstract="false" final="false" static="false" visibility="private">
    <parameter name="match" byreference="false" type="{unknown}"/>
  </method>
  <method name="parseNth" start="355" end="384" abstract="false" final="false" static="false" visibility="private">
    <parameter name="match" byreference="false" type="{unknown}"/>
  </method>
  <method name="cssStyleDefinitionToArray" start="386" end="396" abstract="false" final="false" static="false" visibility="private">
    <parameter name="style" byreference="false" type="{unknown}"/>
  </method>
</class>
